[
  {
    "role": "system",
    "content": "你是一个智能数据搜索助手，专门负责帮助用户查询和检索数据。\n\n⚠️ 重要：你必须严格按照JSON格式输出，不能输出普通文本回复！\n\n【你的专业领域】：\n- 数据库查询（SQLite）\n- 文件内容搜索\n- 数据分析和信息提取\n- 生成结构化的搜索计划\n- 多维度数据检索\n\n【你的核心能力】：\n1. 理解用户的搜索需求\n2. 判断是否需要进行数据检索\n3. 制定系统化的搜索TODO列表\n4. 执行精准的数据查询\n5. 输出结构化的搜索结果\n\n【支持的数据源】：\n- 数据库：查询表结构、数据内容、模糊检索\n- 文件系统：目录结构、文件内容、行数统计\n- 混合查询：跨数据库和文件的综合检索\n\n【工作模式 - 必须遵守】：\n你的工作分为三种情况，必须输出JSON格式：\n\n阶段一：搜索规划（通过逻辑推理判断→输出搜索规划JSON）\n- ⚠️ **不依赖关键词！必须进行逻辑推理和历史分析！**\n- 分析用户问题的逻辑意图\n- 检查历史记录中是否有相关数据\n- 判断对话模型是否需要上下文数据\n- 生成详细的TODO搜索列表\n- ⚠️ 必须输出JSON格式，不能输出文本！\n\n阶段二：搜索执行（收到TODO列表→立即输出数据查询JSON）\n- 接收TODO列表\n- 逐项执行搜索操作\n- 输出原始搜索结果\n- ⚠️ 必须输出JSON格式，不能输出文本！\n\n特殊情况：非搜索型问题（编程、理论问题→输出\"无需搜索\"JSON）\n- 识别非搜索型任务（如编程、解释概念）\n- **前提：历史中已有完整上下文**\n- 输出空任务列表的JSON\n- ⚠️ 禁止和用户对话、禁止询问需求！\n\n⛔ 禁止行为：\n- **禁止依赖关键词判断**（必须进行逻辑推理！）\n- **禁止忽视历史记录**（必须检查历史中的数据！）\n- **禁止假设对话模型有上下文**（历史中没有时必须搜索！）\n- 禁止对搜索型问题输出普通文本回复\n- 禁止对非搜索型问题和用户对话（如\"请告诉我...\"、\"您需要...\"）\n- 禁止给出操作建议或教程\n- 禁止说\"我无法访问\"或\"你可以这样做\"\n- 禁止询问用户需求或尝试与用户交互\n\n⚠️ 判断原则：\n- 不看关键词，看逻辑和意图\n- 不假设上下文，看历史记录\n- 搜索不仅为用户，更为对话模型提供数据\n- 有疑问时，默认搜索\n\n\n\n【🔍 搜索模式判断 🔍】\n\n⚠️ 核心原则：通过逻辑推理和历史分析判断是否需要搜索\n\n⚠️ 搜索的双重目的：\n1. 为用户提供信息\n2. **为对话模型提供必要的上下文数据**（更重要！）\n\n【强制规则 - 必须遵守】：\n1. 用户对目标对象不确定 → 立即生成搜索规划JSON\n2. 历史中没有相关数据 → 立即生成搜索规划JSON\n3. 对话模型需要上下文 → 立即生成搜索规划JSON\n4. 收到TODO列表 → 立即生成数据查询JSON\n5. 历史中有完整上下文且仅修改 → 输出\"无需搜索\"JSON\n\n【阶段一：初次问询 → 逻辑推理是否需要搜索】\n\n⚠️ 禁止依赖关键词！必须进行逻辑推理！\n\n【搜索判断逻辑 - 按顺序检查】：\n\n第1步：用户是否对目标对象不确定？\n✅ 不确定的表现：\n- 使用疑问句式（\"哪个\"、\"哪些\"、\"什么\"、\"在哪\"...）\n- 表达记忆模糊（\"我记得\"、\"好像\"、\"应该\"、\"大概\"...）\n- 需要确认信息（\"有没有\"、\"存不存在\"...）\n- 描述特征而非具体名称（\"有XX功能的那个程序\"、\"包含XX的文件\"...）\n\n→ 如果用户对目标不确定 → **必须搜索！** 输出搜索规划JSON\n\n第2步：检查历史记录中是否有用户提到的对象\n✅ 仔细分析对话历史：\n- 历史中是否**明确出现过**用户提到的文件名/数据库/表名？\n- 历史中是否有该对象的**完整内容**？\n- 历史中是否有**最近的搜索结果**包含该对象？\n- 用户提到的对象在历史中**最后一次出现是什么时候**？\n\n→ 如果历史中**没有该对象的完整信息** → **必须搜索！** 输出搜索规划JSON\n→ 如果历史中**很久之前出现过**（超过10轮对话）→ **必须搜索！** 输出搜索规划JSON\n\n第3步：对话模型是否需要这些数据来完成任务？\n✅ 分析用户意图：\n- 用户是否要求**修改、删除、添加**内容？\n- 对话模型是否需要**当前数据内容**来进行操作？\n- 即使用户说得很明确，对话模型是否**缺少必要的上下文**？\n\n→ 如果对话模型需要数据 → **必须搜索！** 输出搜索规划JSON\n\n【核心原则 - 宁可多搜不可漏搜】：\n搜索的成本很低，但缺少上下文的成本很高！\n当你不确定是否需要搜索时 → **默认搜索！**\n\n❌ 非搜索型问题（分三种情况处理）：\n\n【情况1：首次创建程序 → 输出\"创建文件\"JSON】\n- 首次创建关键词：\"帮我编写一个PLC程序\"、\"写一个新的函数\"、\"创建一个程序\"\n- 没有上下文的编程请求：\"生成一个控制器\"\n\n⚠️ 遇到首次创建任务时，必须创建目标文件：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"这是编程任务，需要准备输出文件\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"创建文件\",\n      \"目标对象\": \"Data/plc_program.st\",\n      \"参数\": {\"文件路径\": \"Data/plc_program.st\"},\n      \"目的\": \"为PLC程序创建输出文件\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n【情况2：修改现有程序 → 需要逻辑判断】\n\n⚠️ 关键判断逻辑（按顺序检查）：\n\n第1步：用户提到的对象是否明确？\n- ❌ 不明确：\"我记得**哪个**PLC程序，有PID逻辑，帮我删了他\"\n  → 用户不确定是哪个文件 → **必须搜索！**\n- ✅ 明确：\"帮我把Data/plc_program.st里的PID逻辑删了\"\n  → 继续第2步判断\n\n第2步：历史记录中是否有该对象的完整数据？\n- ❌ 没有：历史中从未出现过该文件内容\n  → **必须搜索！** 对话模型需要文件内容才能修改\n- ❌ 数据过时：历史中很久之前出现过\n  → **必须搜索！** 需要获取最新数据\n- ✅ 有完整数据：历史中最近几轮包含完整文件内容\n  → 继续第3步判断\n\n第3步：对话模型是否有足够的上下文来完成修改？\n- ❌ 不够：虽然历史中有，但信息不完整（如只有部分内容）\n  → **必须搜索！**\n- ✅ 足够：历史中有完整的、最新的文件内容\n  → 输出空任务列表\n\n⚠️ 只有同时满足以下**所有条件**时才输出空任务列表：\n1. 用户对目标对象非常明确（具体文件名/路径）\n2. 历史记录中有该对象的完整内容\n3. 历史数据是最近的（5轮对话内）\n4. 对话模型有足够上下文来完成修改\n\n⚠️ 遇到符合条件的纯修改任务时：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"这是程序修改任务，对话模型已有完整上下文\",\n  \"任务列表\": []\n}\n\n【情况3：纯理论问题 → 输出\"无需操作\"JSON】\n- 纯理论问题：\"什么是数据库？\"、\"解释一下原理\"\n- 概念解释：\"SQL是什么？\"\n- 没有任何搜索关键词\n\n⚠️ 遇到纯理论问题时：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"无需搜索，这是纯理论问题\",\n  \"任务列表\": []\n}\n\n❌ 禁止行为：\n- 禁止输出\"请告诉我...\"、\"您需要...\"等询问用户的话\n- 禁止尝试和用户对话\n- 禁止给出编程建议或教程\n- 必须输出上述JSON格式\n\n【阶段二：收到TODO → 必须输出数据查询JSON】\n\n✅ 触发条件：\n- 用户消息包含TODO列表\n- 用户说\"开始搜索\"/\"执行搜索\"\n- 消息包含多个待查询项目\n\n【输出格式】：\n\n■ 阶段一（搜索规划JSON）：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"[简要说明]\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"[操作类型]\",\n      \"目标对象\": \"[具体对象]\",\n      \"参数\": {...},\n      \"目的\": \"[目的说明]\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n■ 阶段二（数据查询JSON）：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {...}\n}\n\n【示例 - 严格遵守逻辑推理】：\n\n✅ 示例1 - 用户对目标不确定（必须搜索）：\n用户：\"我记得哪个PLC程序，有PID逻辑，你帮我删了他？\"\n【逻辑推理】：\n- 用户使用了\"哪个\"疑问词 → 用户不确定是哪个文件\n- 用户说\"我记得\" → 记忆模糊\n- 用户描述了特征\"有PID逻辑\" → 不是具体文件名\n【结论】：用户对目标不确定 → **必须搜索！**\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"我记得哪个PLC程序，有PID逻辑，你帮我删了他？\",\n  \"搜索策略\": \"用户对目标文件不确定，需要搜索包含PID逻辑的PLC程序\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询文件目录\",\n      \"目标对象\": \"Data/\",\n      \"参数\": {\"文件路径\": \"Data/\"},\n      \"目的\": \"列出所有PLC程序文件\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 2,\n      \"操作类型\": \"模糊查询文件\",\n      \"目标对象\": \"Data/*.st\",\n      \"参数\": {\"文件路径\": \"Data/\", \"关键词\": \"PID\"},\n      \"目的\": \"查找包含PID逻辑的文件\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例2 - 历史中没有数据（必须搜索）：\n用户：\"帮我把Data/plc_program.st里的PID逻辑删了\"\n【逻辑推理】：\n- 用户目标明确：具体文件名Data/plc_program.st\n- 检查历史：历史记录中没有该文件的内容\n- 对话模型需要：需要文件内容才能删除PID逻辑\n【结论】：虽然目标明确，但对话模型缺少必要上下文 → **必须搜索！**\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"帮我把Data/plc_program.st里的PID逻辑删了\",\n  \"搜索策略\": \"目标明确但历史中无该文件内容，需要为对话模型提供数据\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询文件内容\",\n      \"目标对象\": \"Data/plc_program.st\",\n      \"参数\": {\"文件路径\": \"Data/plc_program.st\"},\n      \"目的\": \"为对话模型提供文件内容以便修改\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例3 - 历史中有完整数据（无需搜索）：\n用户：\"帮我加入PID逻辑\"\n【逻辑推理】：\n- 用户目标：添加功能到当前文件\n- 检查历史：最近3轮对话中有完整的文件内容\n- 对话模型：有足够上下文进行修改\n【结论】：对话模型有完整上下文 → 无需搜索\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"帮我加入PID逻辑\",\n  \"搜索策略\": \"这是程序修改任务，对话模型已有完整上下文\",\n  \"任务列表\": []\n}\n\n✅ 示例4 - 首次创建程序（创建文件）：\n用户：\"帮我编写一个PLC程序\"\n【逻辑推理】：\n- 用户意图：首次创建新程序\n- 需要准备：输出文件\n【结论】：创建文件任务\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"帮我编写一个PLC程序\",\n  \"搜索策略\": \"这是编程任务，需要准备输出文件\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"创建文件\",\n      \"目标对象\": \"Data/plc_program.st\",\n      \"参数\": {\"文件路径\": \"Data/plc_program.st\"},\n      \"目的\": \"为PLC程序创建输出文件\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例5 - 纯理论问题（无需搜索）：\n用户：\"数据库查询的原理是什么？\"\n【逻辑推理】：\n- 用户意图：询问概念原理\n- 不涉及具体数据或文件\n【结论】：纯理论问题\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"数据库查询的原理是什么？\",\n  \"搜索策略\": \"无需搜索，这是纯理论问题\",\n  \"任务列表\": []\n}\n\n【禁止事项 - 严格禁止】：\n❌ **依赖关键词判断**（必须进行逻辑推理和历史分析！）\n❌ **忽视历史记录**（必须检查历史中是否有对象的完整数据！）\n❌ **假设对话模型有上下文**（当历史中没有数据时，必须搜索！）\n❌ 对搜索型问题输出文本回复（如\"我无法访问\"、\"你可以用命令\"）\n❌ 对非搜索型问题和用户对话（如\"请告诉我...\"、\"您需要...\"）\n❌ 对非搜索型问题输出文本回复（必须输出\"无需搜索\"JSON）\n❌ 阶段一输出\"数据查询\"JSON\n❌ 阶段二输出\"搜索规划\"JSON\n❌ 使用```包装JSON\n❌ 混淆两种JSON类型\n❌ 给出操作建议或教程\n\n【核心记忆 - 必须牢记】：\n✓ 不看关键词，看逻辑！\n✓ 不假设上下文，看历史！\n✓ 不仅为用户，更为对话模型提供数据！\n✓ 有疑问时，默认搜索！\n\n\n\n【📋 TODO列表生成规则 📋】\n\n⚠️ 核心原则：将模糊需求转化为具体可执行的查询任务\n\n【生成策略】：\n- 分解：复杂问题→多个简单查询\n- 具体化：明确数据库/表/文件/关键词\n- 全面性：覆盖所有相关数据源\n\n【TODO格式】：\n\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"[简要说明]\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"[操作类型]\",\n      \"目标对象\": \"[具体对象]\",\n      \"参数\": {},\n      \"目的\": \"[目的说明]\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n【操作类型】：\n- 查询数据库表、查询表内容、检查数据存在性、统计数据数量\n- 批量查询、按条件筛选、全库模糊查询\n- 查询文件目录、查询文件内容、查询文件行数、模糊查询文件\n- 联网搜索\n\n【场景示例】：\n\n✅ 示例1 - 关键词搜索：\n用户：\"数据库里有没有关于PID的配置？\"\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"数据库里有没有关于PID的配置？\",\n  \"搜索策略\": \"先确认数据库表结构，再模糊搜索\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询数据库表\",\n      \"目标对象\": \"config_db\",\n      \"参数\": {\"数据库\": \"config_db\"},\n      \"目的\": \"列出所有表\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 2,\n      \"操作类型\": \"全库模糊查询\",\n      \"目标对象\": \"config_db\",\n      \"参数\": {\"数据库\": \"config_db\", \"关键词\": \"PID\"},\n      \"目的\": \"搜索包含PID的记录\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例2 - 查询目录文件列表：\n用户：\"查询一下Data/record/目录下有哪些日志文件？\"\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"查询一下Data/record/目录下有哪些日志文件？\",\n  \"搜索策略\": \"列出指定目录下的所有文件\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询文件目录\",\n      \"目标对象\": \"Data/record/\",\n      \"参数\": {\"文件路径\": \"Data/record/\"},\n      \"目的\": \"列出该目录下所有日志文件\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例3 - 文件内容搜索：\n用户：\"配置文件里有没有设置超时时间？\"\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"配置文件里有没有设置超时时间？\",\n  \"搜索策略\": \"列出配置目录，用关键词搜索文件内容\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询文件目录\",\n      \"目标对象\": \"config/\",\n      \"参数\": {\"文件路径\": \"config/\"},\n      \"目的\": \"列出所有配置文件\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 2,\n      \"操作类型\": \"模糊查询文件\",\n      \"目标对象\": \"config/settings.json\",\n      \"参数\": {\"文件路径\": \"config/settings.json\", \"关键词\": \"timeout\"},\n      \"目的\": \"搜索关键词\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n❌ 错误示例 - 禁止这样回复：\n用户：\"查询一下Data/record/目录下有哪些日志文件？\"\n错误回复：\"由于我无法直接访问你的文件系统，你可以使用ls命令...\"\n正确做法：立即输出上面的搜索规划JSON格式！\n\n✅ 示例4 - 跨数据源+联网：\n用户：\"找一下所有关于控制器的信息\"\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"找一下所有关于控制器的信息\",\n  \"搜索策略\": \"搜索数据库、文件和网络资源\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"全库模糊查询\",\n      \"目标对象\": \"config_db\",\n      \"参数\": {\"数据库\": \"config_db\", \"关键词\": \"controller\"},\n      \"目的\": \"数据库中搜索\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 2,\n      \"操作类型\": \"模糊查询文件\",\n      \"目标对象\": \"docs/\",\n      \"参数\": {\"文件路径\": \"docs/\", \"关键词\": \"controller\"},\n      \"目的\": \"文件中搜索\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 3,\n      \"操作类型\": \"联网搜索\",\n      \"目标对象\": \"网络\",\n      \"参数\": {\"关键词\": \"controller tutorial\"},\n      \"目的\": \"获取最新教程\",\n      \"是否联网\": true\n    }\n  ]\n}\n\n【质量检查】：\n✓ 每个TODO有明确操作对象\n✓ 顺序合理（考虑依赖关系）\n✓ 覆盖用户需求所有方面\n✓ 避免重复查询\n✓ 包含必要验证步骤\n\n【禁止事项】：\n❌ TODO过于笼统\n❌ 缺少具体对象\n❌ 逻辑顺序混乱\n❌ 重复查询\n❌ 缺少目的说明\n❌ 一个TODO包含多个操作\n\n\n\n【🔎 搜索执行规则 🔎】\n\n⚠️ 核心原则：将TODO列表转化为精确的JSON查询语句\n\n【执行时机】：\n✓ 收到TODO列表的消息\n✓ 用户说\"开始搜索\"/\"执行查询\"\n\n【执行流程】：\n1. 解析TODO列表→提取操作类型和参数\n2. 映射到查询函数→构建完整参数\n3. 生成标准JSON→输出\n\n【TODO→JSON映射表】：\n\n【数据查询操作】→ 类型=\"数据查询\"\n1. 查询数据库表 → {\"查询所有数据表\": [{\"数据库\": \"db\"}]}\n2. 查询表内容 → {\"查询表中所有数据\": [{\"数据库\": \"db\", \"数据表\": \"table\"}]}\n3. 检查存在性 → {\"检查数据是否存在\": [{\"数据库\": \"db\", \"数据表\": \"table\", \"数据ID\": \"id\"}]}\n4. 统计数量 → {\"统计数据数量\": [{\"数据库\": \"db\", \"数据表\": \"table\"}]}\n5. 批量查询 → {\"批量查询\": [{\"数据库\": \"db\", \"数据表\": \"table\", \"数据ID列表\": [\"id1\"]}]}\n6. 按条件筛选 → {\"按条件筛选\": [{\"数据库\": \"db\", \"数据表\": \"table\", \"关键词\": \"keyword\"}]}\n7. 全库模糊查询 → {\"全库模糊查询\": [{\"数据库\": \"db\", \"关键词\": \"keyword\"}]}\n8. 查询文件目录 → {\"查询文件目录\": [{\"文件路径\": \"path\"}]}\n9. 查询文件内容 → {\"查询文件内容\": [{\"文件路径\": \"path\"}]}\n10. 查询文件行数 → {\"查询文件行数\": [{\"文件路径\": \"path\"}]}\n11. 模糊查询文件 → {\"模糊查询文件\": [{\"文件路径\": \"path\", \"关键词\": \"keyword\"}]}\n\n【文件操作】→ 类型=\"文件编辑\"\n12. 创建文件 → {\"类型\": \"文件编辑\", \"参数\": {\"创建文件\": [{\"文件路径\": \"path\"}]}}\n\n【JSON结构模板】：\n\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n【重要规则】：\n1. 不需要的查询用空数组[]（不能省略）\n2. 多个同类查询放同一数组\n3. 参数必须完整（缺一不可）\n4. 字段名统一语言（全中文或全英文）\n5. 不能用```包装JSON\n\n【示例】：\n\n✅ 正确1：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [{\"数据库\": \"config_db\"}],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [{\"数据库\": \"config_db\", \"关键词\": \"PID\"}],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n✅ 正确2：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [{\"文件路径\": \"config/\"}],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": [{\"文件路径\": \"config/settings.json\", \"关键词\": \"timeout\"}]\n  }\n}\n\n❌ 错误1 - 省略空字段：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [{\"数据库\": \"db\"}]\n  }\n}\n\n❌ 错误2 - 混用中英文：\n{\n  \"type\": \"数据查询\",\n  \"params\": {\"数据库\": \"db\"}\n}\n\n❌ 错误3 - 参数不完整：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询表中所有数据\": [{\"数据库\": \"db\"}]\n  }\n}\n\n【禁止事项】：\n❌ 使用```包装JSON\n❌ 省略空字段\n❌ 混用中英文\n❌ 缺少必需参数\n❌ 在JSON中添加注释\n\n\n\n【JSON格式规则】\n\n⚠️ 仅用于阶段二（搜索执行）\n\n【标准结构】：\n\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n【强制约束】：\n1. 只有2个顶级字段：\"类型\"+\"参数\"\n2. \"类型\"值必须是\"数据查询\"\n3. 必须包含全部11个查询字段（空用[]）\n4. 字段名统一语言（全中文或全英文）\n5. 不能有```包装\n6. 不能有注释\n7. 必须用双引号\n8. 数组最后不能有多余逗号\n\n【参数格式】：\n\n1. 查询所有数据表：[{\"数据库\": \"db\"}]\n2. 查询表中所有数据：[{\"数据库\": \"db\", \"数据表\": \"table\"}]\n3. 检查数据是否存在：[{\"数据库\": \"db\", \"数据表\": \"table\", \"数据ID\": \"id\"}]\n4. 统计数据数量：[{\"数据库\": \"db\", \"数据表\": \"table\"}]\n5. 批量查询：[{\"数据库\": \"db\", \"数据表\": \"table\", \"数据ID列表\": [\"id1\", \"id2\"]}]\n6. 按条件筛选：[{\"数据库\": \"db\", \"数据表\": \"table\", \"关键词\": \"keyword\"}]\n7. 全库模糊查询：[{\"数据库\": \"db\", \"关键词\": \"keyword\"}]\n8. 查询文件目录：[{\"文件路径\": \"path\"}]\n9. 查询文件内容：[{\"文件路径\": \"path\"}]\n10. 查询文件行数：[{\"文件路径\": \"path\"}]\n11. 模糊查询文件：[{\"文件路径\": \"path\", \"关键词\": \"keyword\"}]\n\n【重要提示】：\n- 数据库操作必须有\"数据库\"\n- 表操作必须有\"数据库\"+\"数据表\"\n- ID查询必须有\"数据库\"+\"数据表\"+\"数据ID\"\n- 文件操作必须有\"文件路径\"\n- 关键词搜索必须有\"关键词\"\n- 多个同类查询放同一数组\n- 空查询用[]（不能省略字段）\n- 必须用双引号，不能用单引号\n- 路径反斜杠需转义：C:\\\\Users\\\\\n\n【正确示例】：\n\n✅ 示例1：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [{\"数据库\": \"config_db\"}],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [{\"数据库\": \"config_db\", \"关键词\": \"PID\"}],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n✅ 示例2：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [{\"数据库\": \"log_db\", \"数据表\": \"system_log\"}],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [{\"数据库\": \"log_db\", \"数据表\": \"system_log\"}],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n✅ 示例3：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [{\"文件路径\": \"config/\"}],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": [{\"文件路径\": \"config/settings.json\", \"关键词\": \"timeout\"}]\n  }\n}\n\n【错误示例】：\n\n❌ 错误1 - 使用```包装：\n```json\n{\"类型\": \"数据查询\"}\n```\n\n❌ 错误2 - 混用中英文：\n{\n  \"type\": \"数据查询\",\n  \"参数\": {}\n}\n\n❌ 错误3 - 省略空字段：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [{\"数据库\": \"db\"}]\n  }\n}\n\n【禁止事项】：\n❌ 使用```包装\n❌ 混用中英文\n❌ 省略空字段\n❌ 参数不完整\n❌ 添加注释\n❌ 使用单引号\n❌ 数组末尾多余逗号\n\n"
  },
  {
    "role": "system",
    "content": "你是一个智能数据搜索助手，专门负责帮助用户查询和检索数据。\n\n⚠️ 重要：你必须严格按照JSON格式输出，不能输出普通文本回复！\n\n【你的专业领域】：\n- 数据库查询（SQLite）\n- 文件内容搜索\n- 数据分析和信息提取\n- 生成结构化的搜索计划\n- 多维度数据检索\n\n【你的核心能力】：\n1. 理解用户的搜索需求\n2. 判断是否需要进行数据检索\n3. 制定系统化的搜索TODO列表\n4. 执行精准的数据查询\n5. 输出结构化的搜索结果\n\n【支持的数据源】：\n- 数据库：查询表结构、数据内容、模糊检索\n- 文件系统：目录结构、文件内容、行数统计\n- 混合查询：跨数据库和文件的综合检索\n\n【工作模式 - 必须遵守】：\n你的工作分为三种情况，必须输出JSON格式：\n\n阶段一：搜索规划（通过逻辑推理判断→输出搜索规划JSON）\n- ⚠️ **不依赖关键词！必须进行逻辑推理和历史分析！**\n- 分析用户问题的逻辑意图\n- 检查历史记录中是否有相关数据\n- 判断对话模型是否需要上下文数据\n- 生成详细的TODO搜索列表\n- ⚠️ 必须输出JSON格式，不能输出文本！\n\n阶段二：搜索执行（收到TODO列表→立即输出数据查询JSON）\n- 接收TODO列表\n- 逐项执行搜索操作\n- 输出原始搜索结果\n- ⚠️ 必须输出JSON格式，不能输出文本！\n\n特殊情况：非搜索型问题（编程、理论问题→输出\"无需搜索\"JSON）\n- 识别非搜索型任务（如编程、解释概念）\n- **前提：历史中已有完整上下文**\n- 输出空任务列表的JSON\n- ⚠️ 禁止和用户对话、禁止询问需求！\n\n⛔ 禁止行为：\n- **禁止依赖关键词判断**（必须进行逻辑推理！）\n- **禁止忽视历史记录**（必须检查历史中的数据！）\n- **禁止假设对话模型有上下文**（历史中没有时必须搜索！）\n- 禁止对搜索型问题输出普通文本回复\n- 禁止对非搜索型问题和用户对话（如\"请告诉我...\"、\"您需要...\"）\n- 禁止给出操作建议或教程\n- 禁止说\"我无法访问\"或\"你可以这样做\"\n- 禁止询问用户需求或尝试与用户交互\n\n⚠️ 判断原则：\n- 不看关键词，看逻辑和意图\n- 不假设上下文，看历史记录\n- 搜索不仅为用户，更为对话模型提供数据\n- 有疑问时，默认搜索\n\n\n\n【🔍 搜索模式判断 🔍】\n\n⚠️ 核心原则：通过逻辑推理和历史分析判断是否需要搜索\n\n⚠️ 搜索的双重目的：\n1. 为用户提供信息\n2. **为对话模型提供必要的上下文数据**（更重要！）\n\n【强制规则 - 必须遵守】：\n1. 用户对目标对象不确定 → 立即生成搜索规划JSON\n2. 历史中没有相关数据 → 立即生成搜索规划JSON\n3. 对话模型需要上下文 → 立即生成搜索规划JSON\n4. 收到TODO列表 → 立即生成数据查询JSON\n5. 历史中有完整上下文且仅修改 → 输出\"无需搜索\"JSON\n\n【阶段一：初次问询 → 逻辑推理是否需要搜索】\n\n⚠️ 禁止依赖关键词！必须进行逻辑推理！\n\n【搜索判断逻辑 - 按顺序检查】：\n\n第1步：用户是否对目标对象不确定？\n✅ 不确定的表现：\n- 使用疑问句式（\"哪个\"、\"哪些\"、\"什么\"、\"在哪\"...）\n- 表达记忆模糊（\"我记得\"、\"好像\"、\"应该\"、\"大概\"...）\n- 需要确认信息（\"有没有\"、\"存不存在\"...）\n- 描述特征而非具体名称（\"有XX功能的那个程序\"、\"包含XX的文件\"...）\n\n→ 如果用户对目标不确定 → **必须搜索！** 输出搜索规划JSON\n\n第2步：检查历史记录中是否有用户提到的对象\n✅ 仔细分析对话历史：\n- 历史中是否**明确出现过**用户提到的文件名/数据库/表名？\n- 历史中是否有该对象的**完整内容**？\n- 历史中是否有**最近的搜索结果**包含该对象？\n- 用户提到的对象在历史中**最后一次出现是什么时候**？\n\n→ 如果历史中**没有该对象的完整信息** → **必须搜索！** 输出搜索规划JSON\n→ 如果历史中**很久之前出现过**（超过10轮对话）→ **必须搜索！** 输出搜索规划JSON\n\n第3步：对话模型是否需要这些数据来完成任务？\n✅ 分析用户意图：\n- 用户是否要求**修改、删除、添加**内容？\n- 对话模型是否需要**当前数据内容**来进行操作？\n- 即使用户说得很明确，对话模型是否**缺少必要的上下文**？\n\n→ 如果对话模型需要数据 → **必须搜索！** 输出搜索规划JSON\n\n【核心原则 - 宁可多搜不可漏搜】：\n搜索的成本很低，但缺少上下文的成本很高！\n当你不确定是否需要搜索时 → **默认搜索！**\n\n❌ 非搜索型问题（分三种情况处理）：\n\n【情况1：首次创建程序 → 输出\"创建文件\"JSON】\n- 首次创建关键词：\"帮我编写一个PLC程序\"、\"写一个新的函数\"、\"创建一个程序\"\n- 没有上下文的编程请求：\"生成一个控制器\"\n\n⚠️ 遇到首次创建任务时，必须创建目标文件：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"这是编程任务，需要准备输出文件\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"创建文件\",\n      \"目标对象\": \"Data/plc_program.st\",\n      \"参数\": {\"文件路径\": \"Data/plc_program.st\"},\n      \"目的\": \"为PLC程序创建输出文件\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n【情况2：修改现有程序 → 需要逻辑判断】\n\n⚠️ 关键判断逻辑（按顺序检查）：\n\n第1步：用户提到的对象是否明确？\n- ❌ 不明确：\"我记得**哪个**PLC程序，有PID逻辑，帮我删了他\"\n  → 用户不确定是哪个文件 → **必须搜索！**\n- ✅ 明确：\"帮我把Data/plc_program.st里的PID逻辑删了\"\n  → 继续第2步判断\n\n第2步：历史记录中是否有该对象的完整数据？\n- ❌ 没有：历史中从未出现过该文件内容\n  → **必须搜索！** 对话模型需要文件内容才能修改\n- ❌ 数据过时：历史中很久之前出现过\n  → **必须搜索！** 需要获取最新数据\n- ✅ 有完整数据：历史中最近几轮包含完整文件内容\n  → 继续第3步判断\n\n第3步：对话模型是否有足够的上下文来完成修改？\n- ❌ 不够：虽然历史中有，但信息不完整（如只有部分内容）\n  → **必须搜索！**\n- ✅ 足够：历史中有完整的、最新的文件内容\n  → 输出空任务列表\n\n⚠️ 只有同时满足以下**所有条件**时才输出空任务列表：\n1. 用户对目标对象非常明确（具体文件名/路径）\n2. 历史记录中有该对象的完整内容\n3. 历史数据是最近的（5轮对话内）\n4. 对话模型有足够上下文来完成修改\n\n⚠️ 遇到符合条件的纯修改任务时：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"这是程序修改任务，对话模型已有完整上下文\",\n  \"任务列表\": []\n}\n\n【情况3：纯理论问题 → 输出\"无需操作\"JSON】\n- 纯理论问题：\"什么是数据库？\"、\"解释一下原理\"\n- 概念解释：\"SQL是什么？\"\n- 没有任何搜索关键词\n\n⚠️ 遇到纯理论问题时：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"无需搜索，这是纯理论问题\",\n  \"任务列表\": []\n}\n\n❌ 禁止行为：\n- 禁止输出\"请告诉我...\"、\"您需要...\"等询问用户的话\n- 禁止尝试和用户对话\n- 禁止给出编程建议或教程\n- 必须输出上述JSON格式\n\n【阶段二：收到TODO → 必须输出数据查询JSON】\n\n✅ 触发条件：\n- 用户消息包含TODO列表\n- 用户说\"开始搜索\"/\"执行搜索\"\n- 消息包含多个待查询项目\n\n【输出格式】：\n\n■ 阶段一（搜索规划JSON）：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"[简要说明]\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"[操作类型]\",\n      \"目标对象\": \"[具体对象]\",\n      \"参数\": {...},\n      \"目的\": \"[目的说明]\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n■ 阶段二（数据查询JSON）：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {...}\n}\n\n【示例 - 严格遵守逻辑推理】：\n\n✅ 示例1 - 用户对目标不确定（必须搜索）：\n用户：\"我记得哪个PLC程序，有PID逻辑，你帮我删了他？\"\n【逻辑推理】：\n- 用户使用了\"哪个\"疑问词 → 用户不确定是哪个文件\n- 用户说\"我记得\" → 记忆模糊\n- 用户描述了特征\"有PID逻辑\" → 不是具体文件名\n【结论】：用户对目标不确定 → **必须搜索！**\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"我记得哪个PLC程序，有PID逻辑，你帮我删了他？\",\n  \"搜索策略\": \"用户对目标文件不确定，需要搜索包含PID逻辑的PLC程序\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询文件目录\",\n      \"目标对象\": \"Data/\",\n      \"参数\": {\"文件路径\": \"Data/\"},\n      \"目的\": \"列出所有PLC程序文件\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 2,\n      \"操作类型\": \"模糊查询文件\",\n      \"目标对象\": \"Data/*.st\",\n      \"参数\": {\"文件路径\": \"Data/\", \"关键词\": \"PID\"},\n      \"目的\": \"查找包含PID逻辑的文件\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例2 - 历史中没有数据（必须搜索）：\n用户：\"帮我把Data/plc_program.st里的PID逻辑删了\"\n【逻辑推理】：\n- 用户目标明确：具体文件名Data/plc_program.st\n- 检查历史：历史记录中没有该文件的内容\n- 对话模型需要：需要文件内容才能删除PID逻辑\n【结论】：虽然目标明确，但对话模型缺少必要上下文 → **必须搜索！**\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"帮我把Data/plc_program.st里的PID逻辑删了\",\n  \"搜索策略\": \"目标明确但历史中无该文件内容，需要为对话模型提供数据\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询文件内容\",\n      \"目标对象\": \"Data/plc_program.st\",\n      \"参数\": {\"文件路径\": \"Data/plc_program.st\"},\n      \"目的\": \"为对话模型提供文件内容以便修改\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例3 - 历史中有完整数据（无需搜索）：\n用户：\"帮我加入PID逻辑\"\n【逻辑推理】：\n- 用户目标：添加功能到当前文件\n- 检查历史：最近3轮对话中有完整的文件内容\n- 对话模型：有足够上下文进行修改\n【结论】：对话模型有完整上下文 → 无需搜索\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"帮我加入PID逻辑\",\n  \"搜索策略\": \"这是程序修改任务，对话模型已有完整上下文\",\n  \"任务列表\": []\n}\n\n✅ 示例4 - 首次创建程序（创建文件）：\n用户：\"帮我编写一个PLC程序\"\n【逻辑推理】：\n- 用户意图：首次创建新程序\n- 需要准备：输出文件\n【结论】：创建文件任务\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"帮我编写一个PLC程序\",\n  \"搜索策略\": \"这是编程任务，需要准备输出文件\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"创建文件\",\n      \"目标对象\": \"Data/plc_program.st\",\n      \"参数\": {\"文件路径\": \"Data/plc_program.st\"},\n      \"目的\": \"为PLC程序创建输出文件\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例5 - 纯理论问题（无需搜索）：\n用户：\"数据库查询的原理是什么？\"\n【逻辑推理】：\n- 用户意图：询问概念原理\n- 不涉及具体数据或文件\n【结论】：纯理论问题\n✅ 正确输出：\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"数据库查询的原理是什么？\",\n  \"搜索策略\": \"无需搜索，这是纯理论问题\",\n  \"任务列表\": []\n}\n\n【禁止事项 - 严格禁止】：\n❌ **依赖关键词判断**（必须进行逻辑推理和历史分析！）\n❌ **忽视历史记录**（必须检查历史中是否有对象的完整数据！）\n❌ **假设对话模型有上下文**（当历史中没有数据时，必须搜索！）\n❌ 对搜索型问题输出文本回复（如\"我无法访问\"、\"你可以用命令\"）\n❌ 对非搜索型问题和用户对话（如\"请告诉我...\"、\"您需要...\"）\n❌ 对非搜索型问题输出文本回复（必须输出\"无需搜索\"JSON）\n❌ 阶段一输出\"数据查询\"JSON\n❌ 阶段二输出\"搜索规划\"JSON\n❌ 使用```包装JSON\n❌ 混淆两种JSON类型\n❌ 给出操作建议或教程\n\n【核心记忆 - 必须牢记】：\n✓ 不看关键词，看逻辑！\n✓ 不假设上下文，看历史！\n✓ 不仅为用户，更为对话模型提供数据！\n✓ 有疑问时，默认搜索！\n\n\n\n【📋 TODO列表生成规则 📋】\n\n⚠️ 核心原则：将模糊需求转化为具体可执行的查询任务\n\n【生成策略】：\n- 分解：复杂问题→多个简单查询\n- 具体化：明确数据库/表/文件/关键词\n- 全面性：覆盖所有相关数据源\n\n【TODO格式】：\n\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"[用户原始问题]\",\n  \"搜索策略\": \"[简要说明]\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"[操作类型]\",\n      \"目标对象\": \"[具体对象]\",\n      \"参数\": {},\n      \"目的\": \"[目的说明]\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n【操作类型】：\n- 查询数据库表、查询表内容、检查数据存在性、统计数据数量\n- 批量查询、按条件筛选、全库模糊查询\n- 查询文件目录、查询文件内容、查询文件行数、模糊查询文件\n- 联网搜索\n\n【场景示例】：\n\n✅ 示例1 - 关键词搜索：\n用户：\"数据库里有没有关于PID的配置？\"\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"数据库里有没有关于PID的配置？\",\n  \"搜索策略\": \"先确认数据库表结构，再模糊搜索\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询数据库表\",\n      \"目标对象\": \"config_db\",\n      \"参数\": {\"数据库\": \"config_db\"},\n      \"目的\": \"列出所有表\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 2,\n      \"操作类型\": \"全库模糊查询\",\n      \"目标对象\": \"config_db\",\n      \"参数\": {\"数据库\": \"config_db\", \"关键词\": \"PID\"},\n      \"目的\": \"搜索包含PID的记录\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例2 - 查询目录文件列表：\n用户：\"查询一下Data/record/目录下有哪些日志文件？\"\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"查询一下Data/record/目录下有哪些日志文件？\",\n  \"搜索策略\": \"列出指定目录下的所有文件\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询文件目录\",\n      \"目标对象\": \"Data/record/\",\n      \"参数\": {\"文件路径\": \"Data/record/\"},\n      \"目的\": \"列出该目录下所有日志文件\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n✅ 示例3 - 文件内容搜索：\n用户：\"配置文件里有没有设置超时时间？\"\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"配置文件里有没有设置超时时间？\",\n  \"搜索策略\": \"列出配置目录，用关键词搜索文件内容\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"查询文件目录\",\n      \"目标对象\": \"config/\",\n      \"参数\": {\"文件路径\": \"config/\"},\n      \"目的\": \"列出所有配置文件\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 2,\n      \"操作类型\": \"模糊查询文件\",\n      \"目标对象\": \"config/settings.json\",\n      \"参数\": {\"文件路径\": \"config/settings.json\", \"关键词\": \"timeout\"},\n      \"目的\": \"搜索关键词\",\n      \"是否联网\": false\n    }\n  ]\n}\n\n❌ 错误示例 - 禁止这样回复：\n用户：\"查询一下Data/record/目录下有哪些日志文件？\"\n错误回复：\"由于我无法直接访问你的文件系统，你可以使用ls命令...\"\n正确做法：立即输出上面的搜索规划JSON格式！\n\n✅ 示例4 - 跨数据源+联网：\n用户：\"找一下所有关于控制器的信息\"\n{\n  \"类型\": \"搜索规划\",\n  \"用户需求\": \"找一下所有关于控制器的信息\",\n  \"搜索策略\": \"搜索数据库、文件和网络资源\",\n  \"任务列表\": [\n    {\n      \"任务ID\": 1,\n      \"操作类型\": \"全库模糊查询\",\n      \"目标对象\": \"config_db\",\n      \"参数\": {\"数据库\": \"config_db\", \"关键词\": \"controller\"},\n      \"目的\": \"数据库中搜索\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 2,\n      \"操作类型\": \"模糊查询文件\",\n      \"目标对象\": \"docs/\",\n      \"参数\": {\"文件路径\": \"docs/\", \"关键词\": \"controller\"},\n      \"目的\": \"文件中搜索\",\n      \"是否联网\": false\n    },\n    {\n      \"任务ID\": 3,\n      \"操作类型\": \"联网搜索\",\n      \"目标对象\": \"网络\",\n      \"参数\": {\"关键词\": \"controller tutorial\"},\n      \"目的\": \"获取最新教程\",\n      \"是否联网\": true\n    }\n  ]\n}\n\n【质量检查】：\n✓ 每个TODO有明确操作对象\n✓ 顺序合理（考虑依赖关系）\n✓ 覆盖用户需求所有方面\n✓ 避免重复查询\n✓ 包含必要验证步骤\n\n【禁止事项】：\n❌ TODO过于笼统\n❌ 缺少具体对象\n❌ 逻辑顺序混乱\n❌ 重复查询\n❌ 缺少目的说明\n❌ 一个TODO包含多个操作\n\n\n\n【🔎 搜索执行规则 🔎】\n\n⚠️ 核心原则：将TODO列表转化为精确的JSON查询语句\n\n【执行时机】：\n✓ 收到TODO列表的消息\n✓ 用户说\"开始搜索\"/\"执行查询\"\n\n【执行流程】：\n1. 解析TODO列表→提取操作类型和参数\n2. 映射到查询函数→构建完整参数\n3. 生成标准JSON→输出\n\n【TODO→JSON映射表】：\n\n【数据查询操作】→ 类型=\"数据查询\"\n1. 查询数据库表 → {\"查询所有数据表\": [{\"数据库\": \"db\"}]}\n2. 查询表内容 → {\"查询表中所有数据\": [{\"数据库\": \"db\", \"数据表\": \"table\"}]}\n3. 检查存在性 → {\"检查数据是否存在\": [{\"数据库\": \"db\", \"数据表\": \"table\", \"数据ID\": \"id\"}]}\n4. 统计数量 → {\"统计数据数量\": [{\"数据库\": \"db\", \"数据表\": \"table\"}]}\n5. 批量查询 → {\"批量查询\": [{\"数据库\": \"db\", \"数据表\": \"table\", \"数据ID列表\": [\"id1\"]}]}\n6. 按条件筛选 → {\"按条件筛选\": [{\"数据库\": \"db\", \"数据表\": \"table\", \"关键词\": \"keyword\"}]}\n7. 全库模糊查询 → {\"全库模糊查询\": [{\"数据库\": \"db\", \"关键词\": \"keyword\"}]}\n8. 查询文件目录 → {\"查询文件目录\": [{\"文件路径\": \"path\"}]}\n9. 查询文件内容 → {\"查询文件内容\": [{\"文件路径\": \"path\"}]}\n10. 查询文件行数 → {\"查询文件行数\": [{\"文件路径\": \"path\"}]}\n11. 模糊查询文件 → {\"模糊查询文件\": [{\"文件路径\": \"path\", \"关键词\": \"keyword\"}]}\n\n【文件操作】→ 类型=\"文件编辑\"\n12. 创建文件 → {\"类型\": \"文件编辑\", \"参数\": {\"创建文件\": [{\"文件路径\": \"path\"}]}}\n\n【JSON结构模板】：\n\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n【重要规则】：\n1. 不需要的查询用空数组[]（不能省略）\n2. 多个同类查询放同一数组\n3. 参数必须完整（缺一不可）\n4. 字段名统一语言（全中文或全英文）\n5. 不能用```包装JSON\n\n【示例】：\n\n✅ 正确1：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [{\"数据库\": \"config_db\"}],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [{\"数据库\": \"config_db\", \"关键词\": \"PID\"}],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n✅ 正确2：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [{\"文件路径\": \"config/\"}],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": [{\"文件路径\": \"config/settings.json\", \"关键词\": \"timeout\"}]\n  }\n}\n\n❌ 错误1 - 省略空字段：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [{\"数据库\": \"db\"}]\n  }\n}\n\n❌ 错误2 - 混用中英文：\n{\n  \"type\": \"数据查询\",\n  \"params\": {\"数据库\": \"db\"}\n}\n\n❌ 错误3 - 参数不完整：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询表中所有数据\": [{\"数据库\": \"db\"}]\n  }\n}\n\n【禁止事项】：\n❌ 使用```包装JSON\n❌ 省略空字段\n❌ 混用中英文\n❌ 缺少必需参数\n❌ 在JSON中添加注释\n\n\n\n【JSON格式规则】\n\n⚠️ 仅用于阶段二（搜索执行）\n\n【标准结构】：\n\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n【强制约束】：\n1. 只有2个顶级字段：\"类型\"+\"参数\"\n2. \"类型\"值必须是\"数据查询\"\n3. 必须包含全部11个查询字段（空用[]）\n4. 字段名统一语言（全中文或全英文）\n5. 不能有```包装\n6. 不能有注释\n7. 必须用双引号\n8. 数组最后不能有多余逗号\n\n【参数格式】：\n\n1. 查询所有数据表：[{\"数据库\": \"db\"}]\n2. 查询表中所有数据：[{\"数据库\": \"db\", \"数据表\": \"table\"}]\n3. 检查数据是否存在：[{\"数据库\": \"db\", \"数据表\": \"table\", \"数据ID\": \"id\"}]\n4. 统计数据数量：[{\"数据库\": \"db\", \"数据表\": \"table\"}]\n5. 批量查询：[{\"数据库\": \"db\", \"数据表\": \"table\", \"数据ID列表\": [\"id1\", \"id2\"]}]\n6. 按条件筛选：[{\"数据库\": \"db\", \"数据表\": \"table\", \"关键词\": \"keyword\"}]\n7. 全库模糊查询：[{\"数据库\": \"db\", \"关键词\": \"keyword\"}]\n8. 查询文件目录：[{\"文件路径\": \"path\"}]\n9. 查询文件内容：[{\"文件路径\": \"path\"}]\n10. 查询文件行数：[{\"文件路径\": \"path\"}]\n11. 模糊查询文件：[{\"文件路径\": \"path\", \"关键词\": \"keyword\"}]\n\n【重要提示】：\n- 数据库操作必须有\"数据库\"\n- 表操作必须有\"数据库\"+\"数据表\"\n- ID查询必须有\"数据库\"+\"数据表\"+\"数据ID\"\n- 文件操作必须有\"文件路径\"\n- 关键词搜索必须有\"关键词\"\n- 多个同类查询放同一数组\n- 空查询用[]（不能省略字段）\n- 必须用双引号，不能用单引号\n- 路径反斜杠需转义：C:\\\\Users\\\\\n\n【正确示例】：\n\n✅ 示例1：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [{\"数据库\": \"config_db\"}],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [{\"数据库\": \"config_db\", \"关键词\": \"PID\"}],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n✅ 示例2：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [{\"数据库\": \"log_db\", \"数据表\": \"system_log\"}],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [{\"数据库\": \"log_db\", \"数据表\": \"system_log\"}],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}\n\n✅ 示例3：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [{\"文件路径\": \"config/\"}],\n    \"查询文件内容\": [],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": [{\"文件路径\": \"config/settings.json\", \"关键词\": \"timeout\"}]\n  }\n}\n\n【错误示例】：\n\n❌ 错误1 - 使用```包装：\n```json\n{\"类型\": \"数据查询\"}\n```\n\n❌ 错误2 - 混用中英文：\n{\n  \"type\": \"数据查询\",\n  \"参数\": {}\n}\n\n❌ 错误3 - 省略空字段：\n{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [{\"数据库\": \"db\"}]\n  }\n}\n\n【禁止事项】：\n❌ 使用```包装\n❌ 混用中英文\n❌ 省略空字段\n❌ 参数不完整\n❌ 添加注释\n❌ 使用单引号\n❌ 数组末尾多余逗号"
  },
  {
    "role": "user",
    "content": "请根据以下TODO任务生成相应的JSON指令：\n\n        任务信息：\n        - 任务ID: 1\n        - 操作类型: 查询文件内容\n        - 目标对象: Data/plc_program.st\n        - 参数: {'文件路径': 'Data/plc_program.st'}\n        - 目的: 获取源文件代码内容\n\n        ⚠️ 根据操作类型输出对应格式的JSON：\n        - 如果是\"创建文件\"：输出\"文件编辑\"类型JSON，使用\"创建文件\"字段\n        - 如果是查询操作：输出\"数据查询\"类型JSON\n        - 如果是其他文件操作：输出\"文件编辑\"类型JSON\n\n        请输出完整的JSON指令。"
  },
  {
    "role": "assistant",
    "content": "{\n  \"类型\": \"数据查询\",\n  \"参数\": {\n    \"查询所有数据表\": [],\n    \"查询表中所有数据\": [],\n    \"检查数据是否存在\": [],\n    \"统计数据数量\": [],\n    \"批量查询\": [],\n    \"按条件筛选\": [],\n    \"全库模糊查询\": [],\n    \"查询文件目录\": [],\n    \"查询文件内容\": [{\"文件路径\": \"Data/plc_program.st\"}],\n    \"查询文件行数\": [],\n    \"模糊查询文件\": []\n  }\n}"
  }
]