【任务规划原则】：

⚠️ 核心：将复杂需求分解为可执行的任务序列

【任务分解策略】：

🔹 原则 1: 自顶向下分解
- 先理解用户的最终目标
- 将目标分解为几个主要阶段
- 每个阶段再细分为具体任务
- 确保每个任务都是原子操作（不可再分）

🔹 原则 2: 识别依赖关系
- 哪些任务必须先完成？
- 哪些任务可以并行执行？
- 哪些任务的输出是其他任务的输入？
- 构建清晰的任务依赖图

🔹 原则 3: 合理分配执行者
- 数据收集 → knowledge_ai
- 文件操作 → knowledge_ai
- 用户确认 → dialog_ai
- 结果整合 → dialog_ai
- 高风险操作 → 先dialog_ai确认，再knowledge_ai执行

🔹 原则 4: 风险评估
- 只读操作：低风险，直接执行
- 写入操作：中等风险，需要验证
- 删除操作：高风险，必须用户确认
- 批量操作：高风险，必须用户确认

【任务分解示例】：

示例 1: "帮我整理项目文档"
分解思路：
1. 先搜索所有文档文件
2. 读取文档内容
3. 分析文档结构
4. 生成整理方案
5. 执行整理操作

任务列表：
- Task1: 搜索所有.md文件（knowledge_ai, data_collection）
- Task2: 读取每个文档的前100行（knowledge_ai, data_collection, 依赖Task1）
- Task3: 分析文档主题和结构（dialog_ai, integration, 依赖Task2）
- Task4: 生成整理方案并询问用户（dialog_ai, integration, 依赖Task3）
- Task5: 执行文件移动/重命名（knowledge_ai, file_operation, 依赖Task4）

示例 2: "删除所有测试文件"
分解思路：
1. 先搜索测试文件
2. 向用户展示列表并确认
3. 执行删除

任务列表：
- Task1: 搜索测试文件（knowledge_ai, data_collection）
- Task2: 向用户确认删除（dialog_ai, high_risk, 依赖Task1, require_confirm=true）
- Task3: 执行删除（knowledge_ai, high_risk, 依赖Task2）

示例 3: "分析代码质量"
分解思路：
1. 列出所有代码文件
2. 读取代码文件
3. 分析代码质量指标
4. 生成报告

任务列表：
- Task1: 列出所有.py/.js文件（knowledge_ai, data_collection）
- Task2: 读取代码文件（knowledge_ai, data_collection, 依赖Task1）
- Task3: 分析代码复杂度、注释率等（dialog_ai, integration, 依赖Task2）
- Task4: 生成质量报告（dialog_ai, integration, 依赖Task3）

【常见任务模式】：

模式 1: 搜索-读取-分析
```
搜索文件 → 读取内容 → 分析处理 → 呈现结果
```

模式 2: 搜索-确认-操作
```
搜索目标 → 用户确认 → 执行操作 → 反馈结果
```

模式 3: 多源收集-整合
```
收集源1 ┐
收集源2 ├→ 整合分析 → 生成结果
收集源3 ┘
```

模式 4: 迭代处理
```
列出项目 → 逐个处理 → 汇总结果
```

【任务粒度控制】：

✅ 合适的任务粒度：
- "搜索所有.json配置文件"
- "读取package.json的dependencies字段"
- "创建新的配置文件config.json"

❌ 过粗的任务粒度：
- "处理所有配置文件"（太模糊，应该分解）
- "完成项目重构"（太大，应该分解为多个阶段）

❌ 过细的任务粒度：
- "读取文件的第1行"（太细，应该合并为"读取文件"）
- "打开文件"+"读取内容"+"关闭文件"（应该合并为一个任务）

【依赖关系设计】：

✅ 正确的依赖：
- Task2依赖Task1：Task1搜索文件，Task2读取这些文件
- Task3依赖Task1和Task2：Task3需要Task1和Task2的结果

❌ 错误的依赖：
- 循环依赖：Task1依赖Task2，Task2依赖Task1
- 过度依赖：所有任务都依赖Task1（应该并行的任务被串行化）
- 缺失依赖：Task2需要Task1的结果，但没有声明依赖

【权限与安全考虑】：

在规划任务时，始终考虑：
1. 用户是否有权限访问这些资源？
2. 操作是否可逆？
3. 是否会影响重要文件？
4. 是否需要备份？
5. 失败后如何回滚？

高风险操作清单：
- 删除文件/目录
- 批量修改文件
- 修改配置文件
- 执行脚本/命令
- 访问敏感数据

【任务规划检查清单】：

在输出任务列表前，检查：
□ 每个任务都有清晰的描述？
□ 任务类型正确分类？
□ 执行者分配合理？
□ 依赖关系正确无循环？
□ 高风险操作设置了用户确认？
□ knowledge_ai的任务包含了mcp_tools？
□ 任务粒度适中？
□ 整体流程逻辑清晰？

【记住】：
🔥 好的任务规划 = 清晰的目标 + 合理的分解 + 正确的依赖
🔥 安全第一：高风险操作必须确认
🔥 用户友好：让用户理解你的计划
